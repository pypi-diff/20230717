# Comparing `tmp/siat-2.3.9-py3-none-any.whl.zip` & `tmp/siat-2.4.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,10 +1,10 @@
-Zip file size: 1715628 bytes, number of entries: 126
+Zip file size: 1719259 bytes, number of entries: 127
 -rw-rw-rw-  2.0 fat      840 b- defN 23-Apr-10 11:29 siat/__init__.py
--rw-rw-rw-  2.0 fat     2210 b- defN 23-Jul-12 15:22 siat/allin.py
+-rw-rw-rw-  2.0 fat     2286 b- defN 23-Jul-17 01:30 siat/allin.py
 -rw-rw-rw-  2.0 fat      747 b- defN 23-Apr-10 11:29 siat/alpha_vantage_test.py
 -rw-rw-rw-  2.0 fat    28555 b- defN 23-Apr-10 11:29 siat/assets_liquidity.py
 -rw-rw-rw-  2.0 fat     1285 b- defN 23-Apr-10 11:29 siat/assets_liquidity_test.py
 -rw-rw-rw-  2.0 fat    10110 b- defN 23-Apr-10 11:29 siat/barrons_scraping_test.py
 -rw-rw-rw-  2.0 fat    36597 b- defN 23-Apr-10 11:29 siat/beta_adjustment.py
 -rw-rw-rw-  2.0 fat    20433 b- defN 23-Apr-10 11:29 siat/beta_adjustment_china.py
 -rw-rw-rw-  2.0 fat     2467 b- defN 23-Apr-10 11:29 siat/beta_adjustment_test.py
@@ -12,15 +12,15 @@
 -rw-rw-rw-  2.0 fat    99528 b- defN 23-Jun-03 12:59 siat/bond.py
 -rw-rw-rw-  2.0 fat    24155 b- defN 23-Apr-10 11:29 siat/bond_base.py
 -rw-rw-rw-  2.0 fat     3002 b- defN 23-May-25 13:09 siat/bond_china.py
 -rw-rw-rw-  2.0 fat     5246 b- defN 23-Apr-10 11:29 siat/bond_test.py
 -rw-rw-rw-  2.0 fat    28499 b- defN 23-Apr-10 11:29 siat/capm_beta.py
 -rw-rw-rw-  2.0 fat     1745 b- defN 23-Apr-10 11:29 siat/capm_beta_test.py
 -rw-rw-rw-  2.0 fat    38116 b- defN 23-Apr-10 11:29 siat/cmat_commons.py
--rw-rw-rw-  2.0 fat    65384 b- defN 23-Jul-12 15:10 siat/common.py
+-rw-rw-rw-  2.0 fat    66466 b- defN 23-Jul-16 14:53 siat/common.py
 -rw-rw-rw-  2.0 fat    20806 b- defN 23-Apr-11 14:17 siat/compare_cross.py
 -rw-rw-rw-  2.0 fat     3473 b- defN 23-Apr-10 11:29 siat/compare_cross_test.py
 -rw-rw-rw-  2.0 fat     3061 b- defN 23-Apr-10 11:29 siat/concepts_iwencai.py
 -rw-rw-rw-  2.0 fat     4941 b- defN 23-Apr-10 11:29 siat/concepts_kpl.py
 -rw-rw-rw-  2.0 fat      690 b- defN 23-Apr-10 11:29 siat/copyrights.py
 -rw-rw-rw-  2.0 fat    27351 b- defN 23-Apr-10 11:29 siat/cryptocurrency.py
 -rw-rw-rw-  2.0 fat     2669 b- defN 23-Apr-10 11:29 siat/cryptocurrency_test.py
@@ -75,28 +75,29 @@
 -rw-rw-rw-  2.0 fat    95227 b- defN 23-Jul-13 12:04 siat/option_china.py
 -rw-rw-rw-  2.0 fat    16355 b- defN 23-Apr-10 11:29 siat/option_china_test.py
 -rw-rw-rw-  2.0 fat    70231 b- defN 23-Jul-13 12:03 siat/option_pricing.py
 -rw-rw-rw-  2.0 fat     2203 b- defN 23-Apr-10 11:29 siat/option_pricing_test.py
 -rw-rw-rw-  2.0 fat     5908 b- defN 23-Apr-10 11:29 siat/option_sina_api_test.py
 -rw-rw-rw-  2.0 fat     2610 b- defN 23-Apr-10 11:29 siat/proxy_test.py
 -rw-rw-rw-  2.0 fat     1552 b- defN 23-Apr-10 11:29 siat/quandl_test.py
--rw-rw-rw-  2.0 fat    49632 b- defN 23-Jul-14 12:32 siat/risk_adjusted_return.py
+-rw-rw-rw-  2.0 fat    53746 b- defN 23-Jul-16 14:26 siat/risk_adjusted_return.py
 -rw-rw-rw-  2.0 fat     3416 b- defN 23-Apr-10 11:29 siat/risk_adjusted_return_test.py
 -rw-rw-rw-  2.0 fat    75899 b- defN 23-Jul-13 11:58 siat/risk_evaluation.py
 -rw-rw-rw-  2.0 fat     3731 b- defN 23-Apr-10 11:29 siat/risk_evaluation_test.py
 -rw-rw-rw-  2.0 fat    12388 b- defN 23-Jul-13 11:53 siat/risk_free_rate.py
 -rw-rw-rw-  2.0 fat     4285 b- defN 23-Apr-10 11:29 siat/risk_free_rate_test.py
 -rw-rw-rw-  2.0 fat   102148 b- defN 23-Jul-13 11:51 siat/sector_china.py
 -rw-rw-rw-  2.0 fat     5843 b- defN 23-Apr-11 14:17 siat/sector_china_test.py
 -rw-rw-rw-  2.0 fat    29185 b- defN 23-May-25 02:36 siat/security_price.py
 -rw-rw-rw-  2.0 fat    74707 b- defN 23-Jul-14 12:33 siat/security_prices.py
 -rw-rw-rw-  2.0 fat    10779 b- defN 23-Apr-10 11:29 siat/security_prices_test.py
+-rw-rw-rw-  2.0 fat    10785 b- defN 23-Jul-17 05:07 siat/security_trend.py
 -rw-rw-rw-  2.0 fat     1335 b- defN 23-Apr-10 11:29 siat/setup.py
 -rw-rw-rw-  2.0 fat     1418 b- defN 23-Apr-10 11:29 siat/shenwan index history test.py
--rw-rw-rw-  2.0 fat   130763 b- defN 23-Jul-14 12:28 siat/stock.py
+-rw-rw-rw-  2.0 fat   130944 b- defN 23-Jul-16 13:45 siat/stock.py
 -rw-rw-rw-  2.0 fat    31655 b- defN 23-Apr-10 11:29 siat/stock_advice_linear.py
 -rw-rw-rw-  2.0 fat     1312 b- defN 23-Apr-10 11:29 siat/stock_base.py
 -rw-rw-rw-  2.0 fat    83256 b- defN 23-Jul-13 11:37 siat/stock_china.py
 -rw-rw-rw-  2.0 fat     1294 b- defN 23-Jun-14 07:32 siat/stock_china_test.py
 -rw-rw-rw-  2.0 fat  1266744 b- defN 23-Jun-05 00:13 siat/stock_info.pickle
 -rw-rw-rw-  2.0 fat     6122 b- defN 23-Apr-10 11:29 siat/stock_info_test.py
 -rw-rw-rw-  2.0 fat     1014 b- defN 23-Apr-10 11:29 siat/stock_list_china_test.py
@@ -117,12 +118,12 @@
 -rw-rw-rw-  2.0 fat   118133 b- defN 23-Apr-10 11:29 siat/translate-20230206.py
 -rw-rw-rw-  2.0 fat   121657 b- defN 23-Apr-10 11:29 siat/translate-20230215.py
 -rw-rw-rw-  2.0 fat   134125 b- defN 23-Jul-13 11:40 siat/translate.py
 -rw-rw-rw-  2.0 fat     3936 b- defN 23-Apr-10 11:29 siat/universal_test.py
 -rw-rw-rw-  2.0 fat    52191 b- defN 23-Jul-13 11:46 siat/valuation_china.py
 -rw-rw-rw-  2.0 fat     1571 b- defN 23-Apr-10 11:29 siat/valuation_market_china_test.py
 -rw-rw-rw-  2.0 fat    14859 b- defN 23-Apr-10 11:29 siat/var_model_validation.py
--rw-rw-rw-  2.0 fat     1384 b- defN 23-Jul-14 13:31 siat-2.3.9.dist-info/METADATA
--rw-rw-rw-  2.0 fat       92 b- defN 23-Jul-14 13:31 siat-2.3.9.dist-info/WHEEL
--rw-rw-rw-  2.0 fat        5 b- defN 23-Jul-14 13:31 siat-2.3.9.dist-info/top_level.txt
-?rw-rw-r--  2.0 fat    10131 b- defN 23-Jul-14 13:31 siat-2.3.9.dist-info/RECORD
-126 files, 7814189 bytes uncompressed, 1700162 bytes compressed:  78.2%
+-rw-rw-rw-  2.0 fat     1422 b- defN 23-Jul-17 05:14 siat-2.4.0.dist-info/METADATA
+-rw-rw-rw-  2.0 fat       92 b- defN 23-Jul-17 05:14 siat-2.4.0.dist-info/WHEEL
+-rw-rw-rw-  2.0 fat        5 b- defN 23-Jul-17 05:14 siat-2.4.0.dist-info/top_level.txt
+?rw-rw-r--  2.0 fat    10211 b- defN 23-Jul-17 05:14 siat-2.4.0.dist-info/RECORD
+127 files, 7830545 bytes uncompressed, 1703673 bytes compressed:  78.2%
```

## zipnote {}

```diff
@@ -267,14 +267,17 @@
 
 Filename: siat/security_prices.py
 Comment: 
 
 Filename: siat/security_prices_test.py
 Comment: 
 
+Filename: siat/security_trend.py
+Comment: 
+
 Filename: siat/setup.py
 Comment: 
 
 Filename: siat/shenwan index history test.py
 Comment: 
 
 Filename: siat/stock.py
@@ -360,20 +363,20 @@
 
 Filename: siat/valuation_market_china_test.py
 Comment: 
 
 Filename: siat/var_model_validation.py
 Comment: 
 
-Filename: siat-2.3.9.dist-info/METADATA
+Filename: siat-2.4.0.dist-info/METADATA
 Comment: 
 
-Filename: siat-2.3.9.dist-info/WHEEL
+Filename: siat-2.4.0.dist-info/WHEEL
 Comment: 
 
-Filename: siat-2.3.9.dist-info/top_level.txt
+Filename: siat-2.4.0.dist-info/top_level.txt
 Comment: 
 
-Filename: siat-2.3.9.dist-info/RECORD
+Filename: siat-2.4.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## siat/allin.py

```diff
@@ -72,20 +72,23 @@
 
 # 中国的行业分析
 from siat.sector_china import *
 
 # 中国股票市场股指
 from siat.valuation_china import *
 
-# 获取证券价格-套壳
+# 获取证券价格与计算
 from siat.security_prices import *
 
 # 股票分析
 from siat.stock import *
 
+# 股票趋势分析，集成函数
+from siat.security_trend import *
+
 # 中国的股票
 from siat.stock_china import *
 
 # 中国股票市场概况
 from siat.market_china import *
 
 # 证券交易-套壳
```

## siat/common.py

```diff
@@ -1680,15 +1680,15 @@
                     start='2022-1-1',end='2023-1-31',
                     market='US',market_index='^GSPC',
                     window=240,axhline_label='指标零线')    
     titletxt="This is the title text"
     footnote="This is the footnote"
 
 def descriptive_statistics(df,titletxt,footnote,decimals=4,sortby='tpw_mean', \
-                           recommend_only=False):
+                           recommend_only=False,trailing=20):
     """
     功能：进行描述性统计，并打印结果
     df的要求：
     索引列为datetime格式，不带时区
     各个列为比较对象，均为数值型，降序排列
     
     sortby='tpw_mean'：按照近期时间优先加权(time priority weighted)平均数排序
@@ -1700,58 +1700,78 @@
         print("  #Error(descriptive_statistics): df is None")
         return
     
     if len(df) == 0:
         print("  #Error(descriptive_statistics): df is empty")
         return
     
+    # 计算短期趋势
+    df20=df[-trailing:]
+    df20ds=df20.describe()
+    df20mean=df20ds[df20ds.index=='mean'].T
+    
+    df20tail=df20.tail(1).T
+    df20tail.columns=['last']
+    
+    import pandas as pd
+    df20trailing=pd.merge(df20tail,df20mean,left_index=True,right_index=True)
+    df20trailing['trailing']=df20trailing['last']-df20trailing['mean']
+    
     ds=df.describe(include='all',percentiles=[.5])
     dst=ds.T   
     #cols=['min','max','50%','mean','std']
-    cols=['min','max','50%','mean']
+    cols=['min','max','50%','mean','trailing']
     
     dst['item']=dst.index
+    dstt=pd.merge(dst,df20trailing['trailing'],left_index=True,right_index=True)
     #cols2=['item','min','max','50%','mean','std']
-    cols2=['item','min','max','50%','mean']
-    
+    cols2=['item','min','max','50%','mean','trailing']
     
-    dst2=dst[cols2]
+    dst2=dstt[cols2]
     for c in cols:
         dst2[c]=dst2[c].apply(lambda x: round(x,decimals))
     
     if sortby != 'tpw_mean': 
         if sortby=='median':
             sortby='50%'
         dst2.sort_values(by=sortby,ascending=False,inplace=True)
 
     #cols2cn=['比较对象','最小值','最大值','中位数','平均值','标准差']
-    cols2cn=['比较对象','最小值','最大值','中位数','平均值']
+    cols2cn=['比较对象','最小值','最大值','中位数','平均值','最新均值差']
     dst2.columns=cols2cn
+    
+    # 近期优先加权平均
     dst2['近期优先加权平均']=dst2['比较对象'].apply(lambda x:time_priority_weighted_average(df,x,4))
     if sortby == "tpw_mean":
         dst2.sort_values(by='近期优先加权平均',ascending=False,inplace=True)
     
     # 去掉带有缺失值的行
     #dst3=dst2.dropna()
     dst3=dst2
     #dst3=dst3[not (dst3['比较对象'] in ['time_weight','relative_weight']) ]
     dst3=dst3[(dst3['比较对象'] != 'time_weight') & (dst3['比较对象'] != 'relative_weight')]
     
     dst3.reset_index(drop=True,inplace=True)
     dst3.index=dst3.index+1
     
     # 趋势标记
-    dst3['趋势']='➠'
-    dst3['趋势']=dst3.apply(lambda x: '➹' if (x['近期优先加权平均']>x['平均值']) & (x['近期优先加权平均']>x['中位数']) else x['趋势'],axis=1)
-    dst3['趋势']=dst3.apply(lambda x: '➷' if (x['近期优先加权平均']<x['平均值']) & (x['近期优先加权平均']<x['中位数']) else x['趋势'],axis=1)
+    #dst3['期间趋势']='➠'
+    dst3['期间趋势']='➷'
+    dst3['期间趋势']=dst3.apply(lambda x: '➹' if (x['近期优先加权平均']>x['平均值']) & (x['近期优先加权平均']>x['中位数']) else x['期间趋势'],axis=1)
+    #dst3['期间趋势']=dst3.apply(lambda x: '➷' if (x['近期优先加权平均']<x['平均值']) & (x['近期优先加权平均']<x['中位数']) else x['期间趋势'],axis=1)
+
+    #dst3['近期趋势']='➠'
+    dst3['近期趋势']='➷'
+    dst3['近期趋势']=dst3.apply(lambda x: '➹' if x['最新均值差'] > 0.0 else x['近期趋势'],axis=1)
+    #dst3['期间趋势']=dst3.apply(lambda x: '➷' if x['最新均值差'] < 0.0 else x['近期趋势'],axis=1)
     
     # 推荐标记
     dst3['推荐标记']=''
 
-    if sortby == 'tpw_mean': #稳健推荐
+    if sortby in ['tpw_mean','trailing']: #稳健推荐
         dst3['推荐标记']=dst3.apply(lambda x: '✮' if (x['近期优先加权平均']>0) else x['推荐标记'],axis=1)
         
         dst3['推荐标记']=dst3.apply(lambda x: '✮✮' if (x['中位数']>0) & (x['平均值']>0) & (x['近期优先加权平均']>0) else x['推荐标记'],axis=1)   
         
         maxvalue=dst3['近期优先加权平均'].max()
         dst3['推荐标记']=dst3.apply(lambda x: '✮✮✮' if (x['近期优先加权平均']==maxvalue) & (x['推荐标记']=='✮✮') else x['推荐标记'],axis=1)
         
@@ -1781,41 +1801,43 @@
     else:
         pass
 
     # 下降趋势时，星星个数降一级，执行顺序不可颠倒
     dst4=dst3
 
     # 一颗星颗星-->无星
-    dst4['推荐标记']=dst4.apply(lambda x: '' if (x['推荐标记']=='✮') & (x['趋势']=='➷') else x['推荐标记'],axis=1)   
+    dst4['推荐标记']=dst4.apply(lambda x: '' if (x['推荐标记']=='✮') & (x['近期趋势']=='➷') else x['推荐标记'],axis=1)   
     
     # 两颗星颗星-->一颗星
-    dst4['推荐标记']=dst4.apply(lambda x: '✮' if (x['推荐标记']=='✮✮') & (x['趋势']=='➷') else x['推荐标记'],axis=1)   
+    dst4['推荐标记']=dst4.apply(lambda x: '✮' if (x['推荐标记']=='✮✮') & (x['近期趋势']=='➷') else x['推荐标记'],axis=1)   
     
     # 三颗星-->两颗星✮
     #dst4['推荐标记']=dst4.apply(lambda x: '✮✮✩' if (x['推荐标记']=='✮✮✮') & (x['趋势']=='➷') else x['推荐标记'],axis=1)
-    dst4['推荐标记']=dst4.apply(lambda x: '✮✮' if (x['推荐标记']=='✮✮✮') & (x['趋势']=='➷') else x['推荐标记'],axis=1)
+    dst4['推荐标记']=dst4.apply(lambda x: '✮✮' if (x['推荐标记']=='✮✮✮') & (x['近期趋势']=='➷') else x['推荐标记'],axis=1)
     
     # 上升趋势时，星星个数加一级，执行顺序不可颠倒
     # 两颗星颗星-->三颗星
-    dst4['推荐标记']=dst4.apply(lambda x: '✮✮✮' if (x['推荐标记']=='✮✮') & (x['趋势']=='➹') else x['推荐标记'],axis=1)   
+    dst4['推荐标记']=dst4.apply(lambda x: '✮✮✮' if (x['推荐标记']=='✮✮') & (x['近期趋势']=='➹') else x['推荐标记'],axis=1)   
     
     # 一颗星颗星-->两颗星
-    dst4['推荐标记']=dst4.apply(lambda x: '✮✮' if (x['推荐标记']=='✮') & (x['趋势']=='➹') else x['推荐标记'],axis=1)   
+    dst4['推荐标记']=dst4.apply(lambda x: '✮✮' if (x['推荐标记']=='✮') & (x['近期趋势']=='➹') else x['推荐标记'],axis=1)   
     
     # 重排序：按照星星个数+数值，降序
     dst5=dst4
     if sortby == "tpw_mean":
         dst5.sort_values(by=['推荐标记','近期优先加权平均'],ascending=[False,False],inplace=True)
         #dst5.sort_values(by=['推荐标记','近期优先加权平均'],ascending=False,inplace=True)
     elif sortby == "min":
         dst5.sort_values(by=['推荐标记','最小值'],ascending=[False,False],inplace=True)
     elif sortby == "mean":
         dst5.sort_values(by=['推荐标记','平均值'],ascending=[False,False],inplace=True)
     elif sortby == "median":
         dst5.sort_values(by=['推荐标记','中位数'],ascending=[False,False],inplace=True)
+    elif sortby == "trailing":
+        dst5.sort_values(by=['推荐标记','最新均值差'],ascending=[False,False],inplace=True)
     else:
         pass
     
     #是否过滤无推荐标志的证券，防止过多无推荐标志的记录使得打印列表过长
     if recommend_only:
         dst6=dst5[dst5['推荐标记'] != '']
         dst_num=len(dst6)
```

## siat/risk_adjusted_return.py

```diff
@@ -1172,23 +1172,32 @@
     axhline_value=0
     axhline_label=''
     graph=True
     printout=True
     sortby='tpw_mean'
     
     graph=False
+    source='auto'
+    trailing=20
 
 def compare_mrar(tickers,rar_name,start,end, \
                  market="China",market_index="000300.SS",RF=False,window=60, \
                  axhline_value=0,axhline_label='零线',graph=True,printout=True, \
-                 sortby='tpw_mean',source='auto'):
+                 sortby='tpw_mean',source='auto',trailing=20):
     """
     功能：计算多只股票的rar比率，并绘图对比
     比率：支持夏普比率、特雷诺比率、索替诺比率、阿尔法比率等
     
+    sortby: 
+        tpw_mean(近期优先加权平均值降序排列)
+        min(最小值降序排列)
+        mean(平均值降序排列)
+        median(中位数值降序排列)
+        trailing(短期趋势，最新数值与近trailing个交易日均值的差值降序排列)
+    
     注意：当RF=False时可能有bug
     """    
     #检查tickers是否为列表且不少于两只股票
     tickers=upper_ticker(tickers)
     
     #检查rar指标的种类
     rarlist=['treynor','sharpe','sortino','alpha']
@@ -1214,15 +1223,15 @@
 
         def __exit__(self, exc_type, exc_val, exc_tb):
             sys.stdout.close()
             sys.stdout = self._original_stdout
     
     import pandas as pd
     df=pd.DataFrame() 
-    print("Starting to retrive and calculate rar ratios, please wait ......")
+    print("Starting to retrive and calculate",rar_name,"ratio, please wait ......")
     for t in tickers:
         
         pf={'Market':(market,market_index),t:1.0}
         #关闭print输出
         with HiddenPrints():
             df_tmp=rar_ratio_rolling(pf,start1,end,ratio_name=rar_name, \
                                      RF=RF,window=window,graph=False,source=source)
@@ -1266,18 +1275,19 @@
         x_label="Source: sina/stooq, "+str(today)
         title_txt="Compare Multiple Risk-adjusted Return Performance"
     else:
         y_label=rar_list_c[pos]
         x_label="数据来源: 新浪/stooq/Yahoo，"+str(today)
         title_txt="比较多只证券的风险调整收益滚动指标"
 
+    startpd=pd.to_datetime(start)
+    df1=df[df.index >= startpd]        
+
     # 是否绘图
     if graph:
-        startpd=pd.to_datetime(start)
-        df1=df[df.index >= startpd]        
         draw_lines(df1,y_label,x_label, \
                    axhline_value=axhline_value,axhline_label=axhline_label, \
                    title_txt=title_txt,data_label=False)
 
     if printout:
         
         dfcols=list(df)
@@ -1289,26 +1299,130 @@
             sortby_txt='按推荐标记+近期优先加权平均值降序排列'
         elif sortby=='min':
             sortby_txt='按推荐标记+最小值降序排列'
         elif sortby=='mean':
             sortby_txt='按推荐标记+平均值降序排列'
         elif sortby=='median':
             sortby_txt='按推荐标记+中位数值降序排列'
+        elif sortby=='trailing':
+            sortby_txt='按推荐标记+短期均值走势降序排列'
         else:
             pass
         
         title_txt='*** '+title_txt+'：'+y_label+'，'+sortby_txt
         additional_note="*** 注：列表仅显示有星号标记或特定数量的证券。"
-        footnote='趋势方向表示的期间范围：'+start+'至'+end
+        footnote='期间趋势的时间范围：'+start+'至'+end+"；近期趋势的时间范围：近"+str(trailing)+"个交易日"
         descriptive_statistics(df,title_txt,additional_note+footnote,decimals=4, \
-                               sortby=sortby,recommend_only=True)
+                               sortby=sortby,recommend_only=True,trailing=trailing)
 
-    return df
+    return df1
 
 if __name__=='__main__':
     tickers = ['000858.SZ','600779.SS','000596.SZ','603589.SS','000001.SS']
     df=compare_mrar(tickers,'sharpe','2022-1-1','2022-10-31')
     df=compare_mrar(tickers,'alpha','2022-10-1','2022-10-31')
 
 #==============================================================================
 
+if __name__=='__main__':
+    ticker = '000858.SZ'
+    start='2022-1-1'
+    end='2022-10-31'
+    rar_names=["sharpe",'sortino','alpha']
+    market_index="000300.SS"
+    market="China"
+    
+    RF=False
+    window=60
+    axhline_value=0
+    axhline_label=''
+    graph=True
+    printout=False
+    sortby='tpw_mean'
+    
+    graph=False
+    source='auto'
+    trailing=20
+
+def compare_1security_mrar(ticker,rar_names,start,end, \
+                 market="China",market_index="000300.SS",RF=False,window=60, \
+                 axhline_value=0,axhline_label='零线',graph=True,printout=False, \
+                 sortby='tpw_mean',source='auto',trailing=20):
+    """
+    功能：计算一只股票的多个rar比率，并绘图对比
+    比率：支持夏普比率、特雷诺比率、索替诺比率、阿尔法比率等
+    
+    sortby: 
+        tpw_mean(近期优先加权平均值降序排列)
+        min(最小值降序排列)
+        mean(平均值降序排列)
+        median(中位数值降序排列)
+        trailing(短期趋势，最新数值与近trailing个交易日均值的差值降序排列)
+    """   
+    DEBUG=True
+    
+    rar_list=['treynor','sharpe','sortino','alpha']
+    rar_list_c=['特雷诺比率','夏普比率','索替诺比率','阿尔法指标']
+    
+    valid,start1,end1=check_period(start,end)
+    if not valid:
+        print("  #Error(compare_1security_mrar): invalid period from",start,'to',end)
+        return None
+    
+    if isinstance(ticker,str):
+        tickers=[ticker]
+    elif isinstance(ticker,list):
+        tickers=[ticker[0]]
+    else:
+        print("  #Warning(compare_1security_mrar): unsupported ticker for",ticker)
+        return None
+    
+    import pandas as pd
+    df=pd.DataFrame()
+    for r in rar_names:
+        if not (r in rar_list):
+            print("  #Warning(compare_1security_mrar): unsupported rar indicator for",r)
+            continue
+        
+        dft=compare_mrar(tickers=tickers,rar_name=r, \
+                         start=start,end=end, \
+                         market=market,market_index=market_index, \
+                         RF=RF,window=window, \
+                         axhline_value=0,axhline_label='零线', \
+                         graph=False,printout=False, \
+                         sortby=sortby,source=source,trailing=trailing)
+        if dft is None:
+            print("  #Error(compare_1security_mrar): information unaccessible for",tickers[0])
+            break
+        if len(dft)==0:
+            print("  #Error(compare_1security_mrar): information unavailable for",tickers[0],'from',start,'to',end)
+            break
+        
+        pos=rar_list.index(r)
+        rcn=rar_list_c[pos]
+        dft.columns=[rcn]
+        
+        if len(df)==0:
+            df=dft
+        else:
+            df=pd.merge(df,dft,how='inner',left_index=True,right_index=True)
+            
+    if len(df)==0:
+        return None
+    
+    import datetime; today = datetime.date.today()
+    y_label="风险调整收益指标"
+    x_label="数据来源: 新浪/stooq/Yahoo，"+str(today)
+    title_txt="比较证券的多种风险调整收益滚动指标："+codetranslate(tickers[0])
+
+    # 是否绘图
+    if graph:
+        draw_lines(df,y_label,x_label, \
+                   axhline_value=axhline_value,axhline_label=axhline_label, \
+                   title_txt=title_txt,data_label=False)
+    
+    return df    
+    
+    
+#==============================================================================
+
```

## siat/stock.py

```diff
@@ -503,14 +503,19 @@
     prdf4=calc_rolling_return(prdf3, "Annual") 
     
     #加入扩展收益率
     erdf=calc_expanding_return(prdf4,fromdate)
 
     return erdf
 
+if __name__ =="__main__":
+    pricedf=get_price("AAPL",'2023-1-1','2023-6-16',adj=True)
+    allind=all_calculate(pricedf,"AAPL",'2023-1-1','2023-6-16')
+    list(allind)
+    
 def all_calculate(pricedf,ticker1,fromdate,todate):
     """
     功能：单纯计算所有基于证券价格的指标
     
     注意：对于滚动指标，起始日期需要提前至少一年以上
     """
     
@@ -1745,15 +1750,15 @@
         x_label=std_notes+'\n'+x_label
         y_label=y_label+measure_suffix
     else:
         dfs2=dfs
 
     # 填充非交易日的缺失值，使得绘制的曲线连续
     dfs2.fillna(axis=0,method='ffill',inplace=True)
-    dfs2.fillna(axis=0,method='bfill',inplace=True)
+    #dfs2.fillna(axis=0,method='bfill',inplace=True)
 
     if 'Ret%' in measure:
         if axhline_label=='':
             axhline_label='收益零线'
 
     #持有类指标的首行置为零
     colList=list(dfs2)
@@ -3426,15 +3431,15 @@
 
     df3=pd.DataFrame(df2[collist])
     for c in collist:
         df3.rename(columns={c:ectranslate(c)},inplace=True)
     
     # 填充非交易日的缺失值，使得绘制的曲线连续
     df3.fillna(axis=0,method='ffill',inplace=True)
-    df3.fillna(axis=0,method='bfill',inplace=True)
+    #df3.fillna(axis=0,method='bfill',inplace=True)
 
     #绘制单个证券的多指标对比图
     y_label=''
     import datetime; today = datetime.date.today()
     
     lang=check_language()
     if lang == 'English':
```

## Comparing `siat-2.3.9.dist-info/RECORD` & `siat-2.4.0.dist-info/RECORD`

 * *Files 3% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 siat/__init__.py,sha256=2dNozwJxztiXwgRY76YQjykPJwAK1SnpN1nNON42c4k,840
-siat/allin.py,sha256=ApPXaJ_ijRrJzr77gXI4Lg7zoyTFdXUuPMRd8EXtMFs,2210
+siat/allin.py,sha256=XcF91rrBNjNIf3opxP-9Ds7GJbNBaZ2S1duu6QgzoSA,2286
 siat/alpha_vantage_test.py,sha256=tKr-vmuFH3CZAqwmISz6jzjPHzV1JJl3sPfZdz8aTfM,747
 siat/assets_liquidity.py,sha256=ma-1rO_t_Mg3j_suWcySHkBoAl-H71CR1dm7iEGAfwM,28555
 siat/assets_liquidity_test.py,sha256=UWk6HIUlizU7LQZ890fGx8LwU1jMMrIZswg8cFUJWZ8,1285
 siat/barrons_scraping_test.py,sha256=jSRVPxyYylcgG3fAsuqE-9WH3sDfJ3CdZUcU8VBVdoU,10110
 siat/beta_adjustment.py,sha256=PW1DgBB17u8jjaDl4Bi6pEQ5RE_tIjg3kZB1xP8l9KI,36597
 siat/beta_adjustment_china.py,sha256=FX5xdGHiVKo0f03RhWmkz398t5VbkvL8Eyw2xLz5Lvw,20433
 siat/beta_adjustment_test.py,sha256=nBhvQQfqxooCHjy5hL0a8V0ZC58BjuCZVFpqpWpHeF0,2467
@@ -11,15 +11,15 @@
 siat/bond.py,sha256=DrspW0zbj1YJm-gMl8jVJF7qNiciSM9sxIBsHk-gyaE,99528
 siat/bond_base.py,sha256=mY1TscUH2kWzsR3Cnh5ea0Xu7-Nc8ZyFupraRipi4BM,24155
 siat/bond_china.py,sha256=ct28F7d6V0m9S3S-t-0lW1ZnSQYSCZhmsCHcZrPZno8,3002
 siat/bond_test.py,sha256=yUOFw7ddGU-kb1rJdnsjkJWziDNgUR7OLDA7F7Ub91A,5246
 siat/capm_beta.py,sha256=L40UbrSU4QQ5CxmEu8CpLT5WptsOUOfDRF7Pxdw6HZs,28499
 siat/capm_beta_test.py,sha256=ImR0c5mc4hIl714XmHztdl7qg8v1E2lycKyiqnFj6qs,1745
 siat/cmat_commons.py,sha256=Nj9Kf0alywaztVoMVeVVL_EZk5jRERJy8R8kBw88_Tg,38116
-siat/common.py,sha256=23MblF1_r4U8fCI9hVhA0tFaU6hIqCYQrDJvartdCnk,65384
+siat/common.py,sha256=c6l2qQJ2jTqs78XkKWJHr-aPXj5zLt_PDNLqe8SIow8,66466
 siat/compare_cross.py,sha256=XXLLBFz66vkrup50ehyP7jR5IyHUB3zqEJGCzWibVYw,20806
 siat/compare_cross_test.py,sha256=xra5XYmQGEtfIZL2h-GssdH2hLdFIhG3eoCrkDrL3gY,3473
 siat/concepts_iwencai.py,sha256=m1YEDtECRT6FqtzlKm91pt2I9d3Z_XoP59BtWdRdu8I,3061
 siat/concepts_kpl.py,sha256=SJ9UaJp5i79EXKZ3dPa_vBEoG_zgl1Ig5rZAm-ubgM4,4941
 siat/copyrights.py,sha256=YMLjZb328YpFMR-s_GUu0HBgeGce3pV7DgRut8S3I7w,690
 siat/cryptocurrency.py,sha256=SKh_S85cqd2tRgKBKls1Fpd6HdFd9JfmUTCa2e3mpsE,27351
 siat/cryptocurrency_test.py,sha256=3AikTNJ7j-HwLGLIYEfyXZ3bLVuLeru9mwiwHQi2SdA,2669
@@ -74,28 +74,29 @@
 siat/option_china.py,sha256=Drrr1QbyOIMwZRTxOc5508BXZTxsOIU0LHy32smgrSs,95227
 siat/option_china_test.py,sha256=UQ-YUHUjoGBQyanLcM-yzqeEIUQP_gCQIeT0W6rnUnA,16355
 siat/option_pricing.py,sha256=hTz0lD4Yoeq0jK4Kt38qKJC_iOz9a5qXC2OeXgnMmv8,70231
 siat/option_pricing_test.py,sha256=eeorV5Ja5vjlRXnP6fWJHetGU5Vb8SnLopkC6RV3GfA,2203
 siat/option_sina_api_test.py,sha256=dn-k_wrQnAaNKHoROvWJEc7lqlU0bwiV2Aa4usWAFGM,5908
 siat/proxy_test.py,sha256=erQJrmGs2X46z8Gb1h-7GYQ0rTUcaR8dxHExWoBz2eM,2610
 siat/quandl_test.py,sha256=EcPoXnLuqzPl5dKyVEZi3j3PJZFpsnU_iNPhLWC9p-A,1552
-siat/risk_adjusted_return.py,sha256=joyMbymxLrbmE6QjBF2u7Y4s9GCwTRiJwCW6IqGsEc8,49632
+siat/risk_adjusted_return.py,sha256=idKiM0tCE82RO7j2ywx9V_PhEc4L6isJZ8i3dcsBTZU,53746
 siat/risk_adjusted_return_test.py,sha256=m_VHL5AtT74cJv5i7taTeTfnkX48y0AFJk5phawyYWg,3416
 siat/risk_evaluation.py,sha256=k5yk4bxKsjxazp-kKfQyrXyFhIHz6fHk3AA4rk2jZXc,75899
 siat/risk_evaluation_test.py,sha256=YEXM96gKzTfwN4U61AS4Rr1tV7KgUvn4rRC6f3iMw9s,3731
 siat/risk_free_rate.py,sha256=X9k-JvEtHkcQxiwCTMtTVz7LHojfAERu7eOzw_hKjsc,12388
 siat/risk_free_rate_test.py,sha256=CpmhUf8aEAEZeNu4gvWP2Mz2dLoIgBX5bI41vfUBEr8,4285
 siat/sector_china.py,sha256=r_Rt63smYYEXxpHJ6mTvi2blO_bZ8yQ11OTi9g2OExY,102148
 siat/sector_china_test.py,sha256=1wq7ef8Bb_L8F0h0W6FvyBrIcBTEbrTV7hljtpj49U4,5843
 siat/security_price.py,sha256=2oHskgiw41KMGfqtnA0i2YjNNV6cYgtlUK0j3YeuXWs,29185
 siat/security_prices.py,sha256=I4pPcKWkWttqvJQgZnLZ94KMkixUPAUMf-E9bzj787A,74707
 siat/security_prices_test.py,sha256=OEphoJ87NPKoNow1QA8EU_5MUYrJF-qKoWKNapVfZNI,10779
+siat/security_trend.py,sha256=P52oIsRsTMam3tSRqGHdK9_bOmDpw3TS6a4LOS569h0,10785
 siat/setup.py,sha256=up65rQGLmTBkhtaMLowjoQXYmIsnycnm4g1SYmeQS6o,1335
 siat/shenwan index history test.py,sha256=JCVAzOSEldHalhSFa3pqD8JI_8_djPMQOxpkuYU-Esg,1418
-siat/stock.py,sha256=svZW74KsNsiVN0Cpdip1BM9LTcQAPRFlPZWBrfumvRY,130763
+siat/stock.py,sha256=BiZBkvHFENjvsvFALetpt52JnkYISKUNf64Ual2nM_o,130944
 siat/stock_advice_linear.py,sha256=-twT7IGP-NEplkL1WPSACcNJjggRB2j4mlAQCkzOAuo,31655
 siat/stock_base.py,sha256=uISvbRyOGy8p9QREA96CVydgflBkn5L3OXOGKl8oanc,1312
 siat/stock_china.py,sha256=IInnxq48z-31QINpIaR2I_s0S74FXa7RNbVXng3Dao4,83256
 siat/stock_china_test.py,sha256=eO4HWsSvc6qezl0LndjtL24lViEyrBjH_sx2c2Y2Q2M,1294
 siat/stock_info.pickle,sha256=o4M-pcN8Sh8QiwZQAZWY1aelI4xgIGIxors7n2uHSJI,1266744
 siat/stock_info_test.py,sha256=gfG3DbhDACbtD8wnv_R6zhj0t11XaC8NX8uLD9Qv3Fo,6122
 siat/stock_list_china_test.py,sha256=gv14UwMMvkZqtb6G7DCTSuehIwVHuVwu7w60p6gyHoo,1014
@@ -116,11 +117,11 @@
 siat/translate-20230206.py,sha256=-vtI125WyaJhmPotOpDAmclt_XnYVaWU9ByLWZ6FyYE,118133
 siat/translate-20230215.py,sha256=TJgtPE3n8IjljmZ4Pefy8dmHoNdFF-1zpML6BhA9FKE,121657
 siat/translate.py,sha256=NHaMYaQRfJJ8eTZc_J05vhhlqvZnYqDymZreR95E7OI,134125
 siat/universal_test.py,sha256=CDAOffW1Rvs-TcNN5giWVvHMlch1w4dp-w5SIV9jXL0,3936
 siat/valuation_china.py,sha256=1hLnVfyQiyHdg2ZSIpNtLgvON-HzKxA7Pf7K01J6ThQ,52191
 siat/valuation_market_china_test.py,sha256=gbJ0ioauuo4koTPH6WKUkqcXiQPafnbhU5eKJ6lpdLA,1571
 siat/var_model_validation.py,sha256=zB_Skk_tmzIR15l6oAW3am4HBGVIG-eZ8gJhCdXZ8Qw,14859
-siat-2.3.9.dist-info/METADATA,sha256=oNwyin1Ud7CiarFQI4kmruefN4DIKWJvG2_C2ZRz3fI,1384
-siat-2.3.9.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
-siat-2.3.9.dist-info/top_level.txt,sha256=r1cVyL7AIKqeAmEJjNR8FMT20OmEzufDstC2gv3NvEY,5
-siat-2.3.9.dist-info/RECORD,,
+siat-2.4.0.dist-info/METADATA,sha256=VWwisIHMkpuEgSzRZUYBwFq4aBZznwMeOw-QYynUOoU,1422
+siat-2.4.0.dist-info/WHEEL,sha256=2wepM1nk4DS4eFpYrW1TTqPcoGNfHhhO_i5m4cOimbo,92
+siat-2.4.0.dist-info/top_level.txt,sha256=r1cVyL7AIKqeAmEJjNR8FMT20OmEzufDstC2gv3NvEY,5
+siat-2.4.0.dist-info/RECORD,,
```

