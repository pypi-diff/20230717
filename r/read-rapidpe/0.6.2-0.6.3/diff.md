# Comparing `tmp/read_rapidpe-0.6.2.tar.gz` & `tmp/read_rapidpe-0.6.3.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "read_rapidpe-0.6.2.tar", max compression
+gzip compressed data, was "read_rapidpe-0.6.3.tar", max compression
```

## Comparing `read_rapidpe-0.6.2.tar` & `read_rapidpe-0.6.3.tar`

### file list

```diff
@@ -1,13 +1,13 @@
--rw-r--r--   0        0        0     2399 2023-04-17 13:15:50.969962 read_rapidpe-0.6.2/README.md
--rw-r--r--   0        0        0      627 2023-06-09 20:33:30.049185 read_rapidpe-0.6.2/pyproject.toml
--rw-r--r--   0        0        0      342 2023-06-04 17:50:03.396354 read_rapidpe-0.6.2/read_rapidpe/__init__.py
--rw-r--r--   0        0        0    11295 2023-05-13 16:31:51.989559 read_rapidpe-0.6.2/read_rapidpe/grid_point.py
--rw-r--r--   0        0        0     3620 2023-06-03 15:19:21.433555 read_rapidpe-0.6.2/read_rapidpe/io.py
--rw-r--r--   0        0        0     6083 2023-04-16 13:20:01.614285 read_rapidpe-0.6.2/read_rapidpe/p_astro.py
--rw-r--r--   0        0        0     9718 2023-04-07 15:04:09.805939 read_rapidpe-0.6.2/read_rapidpe/parser.py
--rw-r--r--   0        0        0     6030 2023-06-07 01:30:58.750555 read_rapidpe-0.6.2/read_rapidpe/plot.py
--rw-r--r--   0        0        0        0 2023-06-06 20:59:26.587831 read_rapidpe-0.6.2/read_rapidpe/plugins/__init__.py
--rw-r--r--   0        0        0     6417 2023-06-09 20:31:55.576251 read_rapidpe-0.6.2/read_rapidpe/plugins/em_bright.py
--rw-r--r--   0        0        0    37550 2023-06-07 01:45:49.754474 read_rapidpe-0.6.2/read_rapidpe/result.py
--rw-r--r--   0        0        0     8855 2023-06-03 14:39:22.849276 read_rapidpe-0.6.2/read_rapidpe/transform.py
--rw-r--r--   0        0        0     3330 1970-01-01 00:00:00.000000 read_rapidpe-0.6.2/PKG-INFO
+-rw-r--r--   0        0        0     2655 2023-06-11 06:40:20.737182 read_rapidpe-0.6.3/README.md
+-rw-r--r--   0        0        0      627 2023-07-17 17:19:35.323229 read_rapidpe-0.6.3/pyproject.toml
+-rw-r--r--   0        0        0      342 2023-06-04 17:50:03.396354 read_rapidpe-0.6.3/read_rapidpe/__init__.py
+-rw-r--r--   0        0        0    11295 2023-05-13 16:31:51.989559 read_rapidpe-0.6.3/read_rapidpe/grid_point.py
+-rw-r--r--   0        0        0     3620 2023-06-03 15:19:21.433555 read_rapidpe-0.6.3/read_rapidpe/io.py
+-rw-r--r--   0        0        0     6083 2023-04-16 13:20:01.614285 read_rapidpe-0.6.3/read_rapidpe/p_astro.py
+-rw-r--r--   0        0        0     9718 2023-04-07 15:04:09.805939 read_rapidpe-0.6.3/read_rapidpe/parser.py
+-rw-r--r--   0        0        0     6030 2023-06-07 01:30:58.750555 read_rapidpe-0.6.3/read_rapidpe/plot.py
+-rw-r--r--   0        0        0        0 2023-06-06 20:59:26.587831 read_rapidpe-0.6.3/read_rapidpe/plugins/__init__.py
+-rw-r--r--   0        0        0     6396 2023-07-17 17:17:57.472760 read_rapidpe-0.6.3/read_rapidpe/plugins/em_bright.py
+-rw-r--r--   0        0        0    37548 2023-07-17 17:21:02.290634 read_rapidpe-0.6.3/read_rapidpe/result.py
+-rw-r--r--   0        0        0     8855 2023-06-03 14:39:22.849276 read_rapidpe-0.6.3/read_rapidpe/transform.py
+-rw-r--r--   0        0        0     3586 1970-01-01 00:00:00.000000 read_rapidpe-0.6.3/PKG-INFO
```

### Comparing `read_rapidpe-0.6.2/README.md` & `read_rapidpe-0.6.3/README.md`

 * *Files 8% similar despite different names*

```diff
@@ -1,10 +1,17 @@
 Read Rapid-PE
 ===
 
+
+[![PyPI Version](https://img.shields.io/pypi/v/read-rapidpe?label=PyPI%20version)](
+https://pypi.org/project/read-rapidpe/)
+[![PyPI Downloads](https://img.shields.io/pypi/dm/read-rapidpe?label=PyPI%20downloads)](
+https://pypi.org/project/read-rapidpe/)
+
+
 This is a package to read Rapid-PE outputs.
 
 # Install
 ## Install from PyPI
 This `read-rapidpe` package is available on PyPI: https://pypi.org/project/read-rapidpe/
 ```
 pip install read-rapidpe
```

### Comparing `read_rapidpe-0.6.2/pyproject.toml` & `read_rapidpe-0.6.3/pyproject.toml`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 [tool.poetry]
 name = "read-rapidpe"
-version = "0.6.2"
+version = "0.6.3"
 description = "Read and analyse results generated by rapidpe-rift-pipe"
 authors = ["Cory Chu <cory@gwlab.page>"]
 readme = "README.md"
 packages = [{include = "read_rapidpe"}]
 homepage = "https://github.com/c0rychu/read-rapidpe"
 repository = "https://git.ligo.org/yu-kuang.chu/read-rapidpe"
```

### Comparing `read_rapidpe-0.6.2/read_rapidpe/grid_point.py` & `read_rapidpe-0.6.3/read_rapidpe/grid_point.py`

 * *Files identical despite different names*

### Comparing `read_rapidpe-0.6.2/read_rapidpe/io.py` & `read_rapidpe-0.6.3/read_rapidpe/io.py`

 * *Files identical despite different names*

### Comparing `read_rapidpe-0.6.2/read_rapidpe/p_astro.py` & `read_rapidpe-0.6.3/read_rapidpe/p_astro.py`

 * *Files identical despite different names*

### Comparing `read_rapidpe-0.6.2/read_rapidpe/parser.py` & `read_rapidpe-0.6.3/read_rapidpe/parser.py`

 * *Files identical despite different names*

### Comparing `read_rapidpe-0.6.2/read_rapidpe/plot.py` & `read_rapidpe-0.6.3/read_rapidpe/plot.py`

 * *Files identical despite different names*

### Comparing `read_rapidpe-0.6.2/read_rapidpe/plugins/em_bright.py` & `read_rapidpe-0.6.3/read_rapidpe/plugins/em_bright.py`

 * *Files 19% similar despite different names*

```diff
@@ -1,62 +1,26 @@
 """
 A middleware for accessing em-bright from read-rapidpe.
 
 Several functions are copied/modified from ligo.em_bright:
-    https://git.ligo.org/emfollow/em-properties/em-bright/-/blob/main/ligo/em_bright/em_bright.py
+    https://git.ligo.org/emfollow/em-properties/em-bright/-/blob/v1.1.4.post2/ligo/em_bright/em_bright.py
 """
 
 
 import h5py
 import numpy as np
 from scipy.interpolate import interp1d
-from astropy import cosmology, units as u
 
 from ligo.em_bright import computeDiskMass, utils
+from ligo.em_bright.em_bright import get_redshifts
 ALL_EOS_DRAWS = utils.load_eos_posterior()
 
 
-def get_redshifts(distances, N=10000):
-    """
-    Compute redshift using the Planck15 cosmology.
-
-    Parameters
-    ----------
-    distances: float or numpy.ndarray
-              distance(s) in Mpc
-
-    N : int, optional
-      Number of steps for the computation of the interpolation function
-
-    Example
-    -------
-    >>> distances = np.linspace(10, 100, 10)
-    >>> em_bright.get_redshifts(distances)
-    array([0.00225566, 0.00450357, 0.00674384, 0.00897655,
-           0.01120181, 0.0134197 , 0.01563032, 0.01783375
-           0.02003009, 0.02221941])
-
-    Notes
-    -----
-    This function accepts HDF5 posterior samples file and computes
-    redshift by interpolating the distance-redshift relation.
-    """
-    function = cosmology.Planck15.luminosity_distance
-    min_dist = np.min(distances)
-    max_dist = np.max(distances)
-    z_min = cosmology.z_at_value(func=function, fval=min_dist*u.Mpc)
-    z_max = cosmology.z_at_value(func=function, fval=max_dist*u.Mpc)
-    z_steps = np.linspace(z_min - (0.1*z_min), z_max + (0.1*z_max), N)
-    lum_dists = cosmology.Planck15.luminosity_distance(z_steps)
-    s = interp1d(lum_dists, z_steps)
-    redshifts = s(distances)
-    return redshifts
-
-
-def em_bright(result, threshold=3.0, num_eos_draws=1000, eos_seed=None):
+def em_bright(result, threshold=3.0, num_eos_draws=2000, eos_seed=None,
+              eosname=None):
     """
     Compute ``HasNS``, ``HasRemnant``, and ``HasMassGap`` probabilities
     from read-rapidpe result.
 
     Parameters
     ----------
     result : RapidPEresult
@@ -79,36 +43,69 @@
 
     """
 
     has_ns, has_remnant, has_massgap = \
         source_classification_samples(samples=result.posterior_samples,
                                       threshold=threshold,
                                       num_eos_draws=num_eos_draws,
-                                      eos_seed=eos_seed)
+                                      eos_seed=eos_seed,
+                                      eosname=eosname)
     return ({
         'HasNS': has_ns,
         'HasRemnant': has_remnant,
         'HasMassGap': has_massgap
     })
 
 
 def source_classification_pe(posterior_samples_file, threshold=3.0,
-                             num_eos_draws=None, eos_seed=None):
+                             num_eos_draws=10000, eos_seed=None,
+                             eosname=None):
+    """
+    Compute ``HasNS``, ``HasRemnant``, and ``HasMassGap`` probabilities
+    from posterior samples.
+
+    Parameters
+    ----------
+    posterior_samples_file : str
+        Posterior samples file
+
+    threshold : float, optional
+        Maximum neutron star mass for `HasNS` computation
+
+    num_eos_draws : int
+        providing an int here runs eos marginalization
+        with the value determining how many eos's to draw
+
+    eos_seed : int
+        seed for random eos draws
+
+    eosname : str
+        Equation of state name, inferred from ``lalsimulation``. Supersedes
+        eos marginalization method when provided.
+
+    Returns
+    -------
+    tuple
+        (HasNS, HasRemnant, HasMassGap) predicted values.
+
+    """
 
     with h5py.File(posterior_samples_file, 'r') as data:
         samples = data['posterior_samples'][()]
 
     return source_classification_samples(samples=samples,
                                          threshold=threshold,
                                          num_eos_draws=num_eos_draws,
-                                         eos_seed=eos_seed)
+                                         eos_seed=eos_seed,
+                                         eosname=eosname)
 
 
 def source_classification_samples(samples, threshold=3.0,
-                                  num_eos_draws=None, eos_seed=None):
+                                  num_eos_draws=10000, eos_seed=None,
+                                  eosname=None):
     """
     Compute ``HasNS``, ``HasRemnant``, and ``HasMassGap`` probabilities
     from posterior samples.
 
     Parameters
     ----------
     samples : dict or recarray
@@ -120,14 +117,18 @@
     num_eos_draws : int
         providing an int here runs eos marginalization
         with the value determining how many eos's to draw
 
     eos_seed : int
         seed for random eos draws
 
+    eosname : str
+        Equation of state name, inferred from ``lalsimulation``. Supersedes
+        eos marginalization method when provided.
+
     Returns
     -------
     tuple
         (HasNS, HasRemnant, HasMassGap) predicted values.
 
     """
 
@@ -151,37 +152,37 @@
     except (ValueError, KeyError):
         try:
             a_1 = samples['a_1'] * np.cos(samples['tilt_1'])
             a_2 = samples['a_2'] * np.cos(samples['tilt_2'])
         except (ValueError, KeyError):
             a_1, a_2 = np.zeros(len(mass_1)), np.zeros(len(mass_2))
 
-    if num_eos_draws:
+    if eosname:
+        M_rem = computeDiskMass.computeDiskMass(mass_1, mass_2, a_1, a_2,
+                                                eosname=eosname)
+        prediction_ns = np.sum(mass_2 <= threshold)/len(mass_2)
+        prediction_em = np.sum(M_rem > 0)/len(M_rem)
+
+    else:
         np.random.seed(eos_seed)
         prediction_nss, prediction_ems = [], []
-
-        m1, m2, a1, a2 = mass_1, mass_2, a_1, a_2
+        # EoS draws from: 10.5281/zenodo.6502467
         rand_subset = np.random.choice(
-            len(ALL_EOS_DRAWS), num_eos_draws if num_eos_draws < len(ALL_EOS_DRAWS) else len(ALL_EOS_DRAWS))  # noqa:E501
+            len(ALL_EOS_DRAWS), num_eos_draws if num_eos_draws < len(ALL_EOS_DRAWS) else len(ALL_EOS_DRAWS), replace=False)  # noqa:E501
         subset_draws = ALL_EOS_DRAWS[rand_subset]
-        M, R = subset_draws['M'], subset_draws['R']
+        # convert radius to m from km
+        M, R = subset_draws['M'], 1000*subset_draws['R']
         max_masses = np.max(M, axis=1)
-        f_M = [interp1d(m, r*1000.0, bounds_error=False) for m, r in zip(M, R)]
-        # r*1000.0 is a temprary fix to convert NS radius from km to m
+        f_M = [interp1d(m, r, bounds_error=False) for m, r in zip(M, R)]
         for mass_radius_relation, max_mass in zip(f_M, max_masses):
-            M_rem = computeDiskMass.computeDiskMass(m1, m2, a1, a2, eosname=mass_radius_relation, max_mass=max_mass)  # noqa:E501
-            prediction_nss.append(np.mean(m2 <= max_mass))
+            M_rem = computeDiskMass.computeDiskMass(mass_1, mass_2, a_1, a_2, eosname=mass_radius_relation, max_mass=max_mass)  # noqa:E501
+            prediction_nss.append(np.mean(mass_2 <= max_mass))
             prediction_ems.append(np.mean(M_rem > 0))
 
         prediction_ns = np.mean(prediction_nss)
         prediction_em = np.mean(prediction_ems)
 
-    else:
-        M_rem = computeDiskMass.computeDiskMass(mass_1, mass_2, a_1, a_2)
-        prediction_ns = np.sum(mass_2 <= threshold)/len(mass_2)
-        prediction_em = np.sum(M_rem > 0)/len(M_rem)
-
     prediction_mg = (mass_1 <= 5) & (mass_1 >= 3)
     prediction_mg += (mass_2 <= 5) & (mass_2 >= 3)
     prediction_mg = np.sum(prediction_mg)/len(mass_1)
 
     return prediction_ns, prediction_em, prediction_mg
```

### Comparing `read_rapidpe-0.6.2/read_rapidpe/result.py` & `read_rapidpe-0.6.3/read_rapidpe/result.py`

 * *Files 0% similar despite different names*

```diff
@@ -856,15 +856,15 @@
 
             x = Mass_Spin.from_x1x2(x1,
                                     x2,
                                     grid_coordinates=self.grid_coordinates)
 
             # An ad-hoc cut on the mass_1 and mass_2
             mask_m1m2 = x.mass_1 < 500
-            # mask_m1m2 &= x.mass_2 > 0.1
+            mask_m1m2 &= x.mass_2 > 0.1
 
             # Re-weight the samples according to the Jacobian such that
             # it has a uniform prior in m1-m2 space
             # Reference: https://dcc.ligo.org/LIGO-T2300198
             if method == "gaussian-resample":
                 weight = x.jacobian_m1m2_by_x1x2[mask_m1m2]
                 weight /= np.sum(weight)
```

### Comparing `read_rapidpe-0.6.2/read_rapidpe/transform.py` & `read_rapidpe-0.6.3/read_rapidpe/transform.py`

 * *Files identical despite different names*

### Comparing `read_rapidpe-0.6.2/PKG-INFO` & `read_rapidpe-0.6.3/PKG-INFO`

 * *Files 7% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: read-rapidpe
-Version: 0.6.2
+Version: 0.6.3
 Summary: Read and analyse results generated by rapidpe-rift-pipe
 Home-page: https://github.com/c0rychu/read-rapidpe
 Author: Cory Chu
 Author-email: cory@gwlab.page
 Requires-Python: >=3.8,<4.0
 Classifier: Programming Language :: Python :: 3
 Classifier: Programming Language :: Python :: 3.8
@@ -21,14 +21,21 @@
 Requires-Dist: scipy (>=1.8.1,<2.0.0)
 Project-URL: Repository, https://git.ligo.org/yu-kuang.chu/read-rapidpe
 Description-Content-Type: text/markdown
 
 Read Rapid-PE
 ===
 
+
+[![PyPI Version](https://img.shields.io/pypi/v/read-rapidpe?label=PyPI%20version)](
+https://pypi.org/project/read-rapidpe/)
+[![PyPI Downloads](https://img.shields.io/pypi/dm/read-rapidpe?label=PyPI%20downloads)](
+https://pypi.org/project/read-rapidpe/)
+
+
 This is a package to read Rapid-PE outputs.
 
 # Install
 ## Install from PyPI
 This `read-rapidpe` package is available on PyPI: https://pypi.org/project/read-rapidpe/
 ```
 pip install read-rapidpe
```

